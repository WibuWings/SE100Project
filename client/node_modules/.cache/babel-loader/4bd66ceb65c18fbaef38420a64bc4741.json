{"ast":null,"code":"'use strict';\n\nmodule.exports = exports = testbinary;\nexports.usage = 'Tests that the binary.node can be required';\n\nconst path = require('path');\n\nconst log = require('npmlog');\n\nconst cp = require('child_process');\n\nconst versioning = require('./util/versioning.js');\n\nconst napi = require('./util/napi.js');\n\nfunction testbinary(gyp, argv, callback) {\n  const args = [];\n  const options = {};\n  let shell_cmd = process.execPath;\n  const package_json = gyp.package_json;\n  const napi_build_version = napi.get_napi_build_version_from_command_args(argv);\n  const opts = versioning.evaluate(package_json, gyp.opts, napi_build_version); // skip validation for runtimes we don't explicitly support (like electron)\n\n  if (opts.runtime && opts.runtime !== 'node-webkit' && opts.runtime !== 'node') {\n    return callback();\n  }\n\n  const nw = opts.runtime && opts.runtime === 'node-webkit'; // ensure on windows that / are used for require path\n\n  const binary_module = opts.module.replace(/\\\\/g, '/');\n\n  if (process.arch !== opts.target_arch || process.platform !== opts.target_platform) {\n    let msg = 'skipping validation since host platform/arch (';\n    msg += process.platform + '/' + process.arch + ')';\n    msg += ' does not match target (';\n    msg += opts.target_platform + '/' + opts.target_arch + ')';\n    log.info('validate', msg);\n    return callback();\n  }\n\n  if (nw) {\n    options.timeout = 5000;\n\n    if (process.platform === 'darwin') {\n      shell_cmd = 'node-webkit';\n    } else if (process.platform === 'win32') {\n      shell_cmd = 'nw.exe';\n    } else {\n      shell_cmd = 'nw';\n    }\n\n    const modulePath = path.resolve(binary_module);\n    const appDir = path.join(__dirname, 'util', 'nw-pre-gyp');\n    args.push(appDir);\n    args.push(modulePath);\n    log.info('validate', \"Running test command: '\" + shell_cmd + ' ' + args.join(' ') + \"'\");\n    cp.execFile(shell_cmd, args, options, (err, stdout, stderr) => {\n      // check for normal timeout for node-webkit\n      if (err) {\n        if (err.killed === true && err.signal && err.signal.indexOf('SIG') > -1) {\n          return callback();\n        }\n\n        const stderrLog = stderr.toString();\n        log.info('stderr', stderrLog);\n\n        if (/^\\s*Xlib:\\s*extension\\s*\"RANDR\"\\s*missing\\s*on\\s*display\\s*\":\\d+\\.\\d+\"\\.\\s*$/.test(stderrLog)) {\n          log.info('RANDR', 'stderr contains only RANDR error, ignored');\n          return callback();\n        }\n\n        return callback(err);\n      }\n\n      return callback();\n    });\n    return;\n  }\n\n  args.push('--eval');\n  args.push(\"require('\" + binary_module.replace(/'/g, '\\'') + \"')\");\n  log.info('validate', \"Running test command: '\" + shell_cmd + ' ' + args.join(' ') + \"'\");\n  cp.execFile(shell_cmd, args, options, (err, stdout, stderr) => {\n    if (err) {\n      return callback(err, {\n        stdout: stdout,\n        stderr: stderr\n      });\n    }\n\n    return callback();\n  });\n}","map":{"version":3,"sources":["D:/UIT/Nam3_HKI/OOP/SE100Project/client/node_modules/@mapbox/node-pre-gyp/lib/testbinary.js"],"names":["module","exports","testbinary","usage","path","require","log","cp","versioning","napi","gyp","argv","callback","args","options","shell_cmd","process","execPath","package_json","napi_build_version","get_napi_build_version_from_command_args","opts","evaluate","runtime","nw","binary_module","replace","arch","target_arch","platform","target_platform","msg","info","timeout","modulePath","resolve","appDir","join","__dirname","push","execFile","err","stdout","stderr","killed","signal","indexOf","stderrLog","toString","test"],"mappings":"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","sourcesContent":["'use strict';\n\nmodule.exports = exports = testbinary;\n\nexports.usage = 'Tests that the binary.node can be required';\n\nconst path = require('path');\nconst log = require('npmlog');\nconst cp = require('child_process');\nconst versioning = require('./util/versioning.js');\nconst napi = require('./util/napi.js');\n\nfunction testbinary(gyp, argv, callback) {\n  const args = [];\n  const options = {};\n  let shell_cmd = process.execPath;\n  const package_json = gyp.package_json;\n  const napi_build_version = napi.get_napi_build_version_from_command_args(argv);\n  const opts = versioning.evaluate(package_json, gyp.opts, napi_build_version);\n  // skip validation for runtimes we don't explicitly support (like electron)\n  if (opts.runtime &&\n        opts.runtime !== 'node-webkit' &&\n        opts.runtime !== 'node') {\n    return callback();\n  }\n  const nw = (opts.runtime && opts.runtime === 'node-webkit');\n  // ensure on windows that / are used for require path\n  const binary_module = opts.module.replace(/\\\\/g, '/');\n  if ((process.arch !== opts.target_arch) ||\n        (process.platform !== opts.target_platform)) {\n    let msg = 'skipping validation since host platform/arch (';\n    msg += process.platform + '/' + process.arch + ')';\n    msg += ' does not match target (';\n    msg += opts.target_platform + '/' + opts.target_arch + ')';\n    log.info('validate', msg);\n    return callback();\n  }\n  if (nw) {\n    options.timeout = 5000;\n    if (process.platform === 'darwin') {\n      shell_cmd = 'node-webkit';\n    } else if (process.platform === 'win32') {\n      shell_cmd = 'nw.exe';\n    } else {\n      shell_cmd = 'nw';\n    }\n    const modulePath = path.resolve(binary_module);\n    const appDir = path.join(__dirname, 'util', 'nw-pre-gyp');\n    args.push(appDir);\n    args.push(modulePath);\n    log.info('validate', \"Running test command: '\" + shell_cmd + ' ' + args.join(' ') + \"'\");\n    cp.execFile(shell_cmd, args, options, (err, stdout, stderr) => {\n      // check for normal timeout for node-webkit\n      if (err) {\n        if (err.killed === true && err.signal && err.signal.indexOf('SIG') > -1) {\n          return callback();\n        }\n        const stderrLog = stderr.toString();\n        log.info('stderr', stderrLog);\n        if (/^\\s*Xlib:\\s*extension\\s*\"RANDR\"\\s*missing\\s*on\\s*display\\s*\":\\d+\\.\\d+\"\\.\\s*$/.test(stderrLog)) {\n          log.info('RANDR', 'stderr contains only RANDR error, ignored');\n          return callback();\n        }\n        return callback(err);\n      }\n      return callback();\n    });\n    return;\n  }\n  args.push('--eval');\n  args.push(\"require('\" + binary_module.replace(/'/g, '\\'') + \"')\");\n  log.info('validate', \"Running test command: '\" + shell_cmd + ' ' + args.join(' ') + \"'\");\n  cp.execFile(shell_cmd, args, options, (err, stdout, stderr) => {\n    if (err) {\n      return callback(err, { stdout: stdout, stderr: stderr });\n    }\n    return callback();\n  });\n}\n"]},"metadata":{},"sourceType":"script"}